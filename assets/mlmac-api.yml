swagger: '2.0'
info:
  description: |
    Machine Learning Model Attribution Challenge API

    In development, the below subject to change.
  version: '1.0.0'
  title: 'MLMAC'
  termsOfService: 'https://mlmac.io/terms/'
  license:
    name: 'Apache 2.0'
    url: 'http://www.apache.org/licenses/LICENSE-2.0.html'
host: 'api.mlmac.io:8080'
basePath: '/'
tags:
  - name: 'Models'
    description: 'MLMAC models'
  - name: 'User'
    description: 'Operations about user'

schemes:
  - 'https'
  - 'http'
paths:
  /query:
    post:
      tags:
        - 'Models'
      summary: 'Query a model'
      description: ''
      parameters:
        - name: 'model'
          in: 'query'
          description: 'Model identifier from 1 to 13'
          required: true
          type: 'integer'
          minimum: 1
          maximum: 13

        - in: 'body'
          name: 'body'
          description: 'input'
          required: true
          schema:
            $ref: '#/definitions/ModelInput'

      responses:
        200:
          description: Successful model output
          schema:
            $ref: '#/definitions/ModelOutputSuccess'
        500:
          description: Internal server error

        503:
          description: Model is currently loading
          schema:
            $ref: '#/definitions/ModelOutputError'

  /github_info:
    get:
      tags:
        - 'User'
      summary: 'My GitHub info'
      description: ''

      responses:
        200:
          description: Authenticated GitHub user data - https://docs.github.com/en/rest/users/users#get-the-authenticated-user

  /status:
    get:
      tags:
        - 'User'
      summary: 'Query totals and other info'
      description: ''

      responses:
        200:
          description: User stats
          schema:
            $ref: '#/definitions/Status'

securityDefinitions:
  bearerAuth: # arbitrary name for the security scheme
    name: 'Authorization'
    in: 'header'
    type: 'apiKey'
    description: 'Use the value of "Bearer your_api_token"'
definitions:
  ModelInput:
    type: 'object'
    properties:
      input:
        type: 'string'
  ModelOutputSuccess:
    type: 'object'
    properties:
      status:
        type: 'string'
        enum:
          - success
        description: Query status
      result:
        type: 'object'
        properties:
          generated_text:
            type: 'string'
      queries:
        $ref: '#/definitions/Queries'
  ModelOutputError:
    type: 'object'
    properties:
      status:
        type: 'string'
        enum:
          - error
        description: Query status
      result:
        type: 'object'
        properties:
          error:
            type: string
            description: 'Either the model is loading, or another error description'
          estimated_time:
            type: number
            description: Estimated time in seconds until the model is ready to be queried
      queries:
        $ref: '#/definitions/Queries'
  Queries:
    type: 'object'
    description: String model number to integer number of queries for that model, if greater than 0
    additionalProperties:
      type: 'integer'
    example:
      '1': 9
      '5': 2
  Status:
    type: 'object'
    properties:
      api_key:
        type: string
      name:
        type: string
        description: GitHub username
      created:
        type: string
        description: Date string of when the API key was registered
      total_queries:
        type: integer
      queries:
        $ref: '#/definitions/Queries'

externalDocs:
  description: 'Find out more about Swagger'
  url: 'http://swagger.io'

security:
  - bearerAuth: []
